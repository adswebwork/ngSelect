/*! ngSelect
version: 0.0.1
build date: 2013-07-20
author: Robin Fan
https://github.com/pc035860/ngSelect.git */
angular.module("ngSelect",[]).controller("ngSelectCtrl",["$scope","$parse",function(a,b){function c(a,b){var c,d=a.length;for(c=0;d>c;c++)if(a[c].value==b)return c;return-1}function d(a){return!isNaN(parseFloat(a))&&isFinite(a)}function e(){var a;if(f.multiple){var b=!1;a=h.getModel(),angular.isArray(a)?a.length=0:(b=!0,a=[]),angular.forEach(j,function(b){b.selected&&a.push(b.value)}),b&&h.setModel(a)}else{a=null;var c,d,e;for(c=0,d=j.length;d>c;c++)if(e=j[c],e.selected){a=e.value;break}h.setModel(a)}}var f,g,h=this,i=0,j=[];h.EVENT_INIT="ngSelect:init",h.EVENT_RENDER="ngSelect:render",h.init=function(c){if(angular.isUndefined(c.model))throw new Error("ngSelect model is required");c=angular.extend({multiple:!1},c),f=angular.copy(c),g=b(c.model);var d=h.getModel();angular.isUndefined(d)&&h.setModel(f.multiple?[]:null),a.$broadcast(h.EVENT_INIT,[f.model])},h.getConfig=function(){return f},h.addOption=function(a){var b={index:i++,value:d(a)?Number(a):a,selected:!1};return j.push(b),b},h.select=function(a){a.selected=!0,f.multiple||angular.forEach(j,function(b){b.index!==a.index&&(b.selected=!1)}),e()},h.unselect=function(a){f.multiple&&(a.selected=!1,e())},h.clear=function(){if(f.multiple){var a=h.getModel();angular.isArray(a)?a.length=0:h.setModel([])}else h.setModel(null)},h.setModel=function(b){var c=g.assign;c(a,b)},h.getModel=function(){return g(a)},h.render=function(){if(!angular.isUndefined(f)){if(f.multiple){for(var b,d,e=angular.copy(h.getModel()),g=angular.extend([],j),i=e.length;i--;)b=e.shift(),d=g.splice(c(g,b),1)[0],d&&(d.selected=!0);angular.forEach(g,function(a){a.selected=!1})}else{var k=!1;angular.forEach(j,function(a){k||a.value!=h.getModel()?a.selected=!1:(a.selected=!0,k=!0)})}a.$broadcast(h.EVENT_RENDER,[f.model])}}}]).directive("ngSelect",["$parse","$timeout",function(a,b){return{restrict:"A",controller:"ngSelectCtrl",link:function(a,c,d,e){var f={};f.multiple=function(){return angular.isUndefined(d.selectMultiple)?!1:""===d.selectMultiple||1===Number(d.selectMultiple)}(),f.model=d.ngSelect,f.classExpr=d.selectClass,f.disabledExpr=d.selectDisabled,b(function(){e.init(f)}),a.$watch(d.ngSelect,function(a,b){a&&!angular.equals(a,b)&&e.render()},!0)}}}]).directive("ngSelectOption",[function(){return{restrict:"A",require:"^ngSelect",link:function(a,b,c,d){function e(a){q=c.selectClass||a.classExpr,p=c.disabledExpr||a.disabledExpr}function f(a){var b={};return angular.forEach(a,function(a,c){b["$"+c]=a}),b}function g(b,c){return a.$eval(b,f(c))}function h(a){o=a,n&&!angular.equals(o,n)&&i(n),j(o),n=angular.copy(o)}function i(a){angular.isObject(a)&&!angular.isArray(a)&&(a=k(a,function(a,b){return a?b:void 0})),b.removeClass(angular.isArray(a)?a.join(" "):a)}function j(a){angular.isObject(a)&&!angular.isArray(a)&&(a=k(a,function(a,b){return a?b:void 0})),a&&b.addClass(angular.isArray(a)?a.join(" "):a)}function k(a,b){var c=[];return angular.forEach(a,function(a,d){var e=b(a,d);e&&c.push(e)}),c}var l,m,n,o,p,q;c.$observe("ngSelectOption",function(e){angular.isDefined(e)&&(l=d.addOption(c.ngSelectOption),b.bind("click",function(){p&&g(p,l)||a.$apply(function(){d[l.selected?"unselect":"select"](l)})}))}),a.$on(d.EVENT_INIT,function(a,b){var c=d.getConfig();angular.isDefined(c)&&c.model===b[0]&&e(c)}),a.$on(d.EVENT_RENDER,function(b,c){var e=d.getConfig();if(angular.isDefined(e)&&e.model===c[0]&&!m&&q){var g=function(a){return a.$eval(q,f(l))};m=a.$watch(g,h,!0)}})}}}]);